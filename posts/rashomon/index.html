<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>æ/Rashomon | blog.AlmostEducated</title>
<meta name=keywords content="programming,clojure,event sourcing,film">
<meta name=description content="See things from another perspective; Clojure functions that build datastructures from events.">
<meta name=author content="AlmostEducated">
<link rel=canonical href=http://blog.almost.education/posts/rashomon/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.58a033c0c7916fad77c5dfdffb45992d585075aa3bd3fd9fed09e7daf663c82b.css integrity="sha256-WKAzwMeRb613xd/f+0WZLVhQdao70/2f7Qnn2vZjyCs=" rel="preload stylesheet" as=style>
<link rel=preload href=/img/ae-logo-trans.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.f5a1b978a132c6aeb40625c357309394e91f4bd93496f86730204de5630b035b.js integrity="sha256-9aG5eKEyxq60BiXDVzCTlOkfS9k0lvhnMCBN5WMLA1s=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=http://blog.almost.education/img/ae-logo-trans.png>
<link rel=icon type=image/png sizes=16x16 href=http://blog.almost.education/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=http://blog.almost.education/favicon-32x32.png>
<link rel=apple-touch-icon href=http://blog.almost.education/img/ae-logo-trans.png>
<link rel=mask-icon href=http://blog.almost.education/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=default"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-15THDLZMKJ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-15THDLZMKJ',{anonymize_ip:!1})}</script>
<meta property="og:title" content="æ/Rashomon">
<meta property="og:description" content="See things from another perspective; Clojure functions that build datastructures from events.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://blog.almost.education/posts/rashomon/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-19T00:00:00+00:00">
<meta property="article:modified_time" content="2021-11-19T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="æ/Rashomon">
<meta name=twitter:description content="See things from another perspective; Clojure functions that build datastructures from events.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://blog.almost.education/posts/"},{"@type":"ListItem","position":3,"name":"æ/Rashomon","item":"http://blog.almost.education/posts/rashomon/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"æ/Rashomon","name":"æ\/Rashomon","description":"See things from another perspective; Clojure functions that build datastructures from events.","keywords":["programming","clojure","event sourcing","film"],"articleBody":" Clojure functions that build datastructures from events with dynamic perspectives.\n Rashomon is a 1950 psychological thriller film directed by Akira Kurosawa. Based on Ryunosuke Akutagawa's In A Grove, it tells the story of a samurai's death from the perspectives of: the bandit who killed him, his wife, the samurai himself, and finally a woodcutter, none of whom can agree at the subsequent trial.\n It was the first Japanese film to receive international acclaim, doing so after being panned by Japanese critics. From the film came the term Rashomon effect, used to describe the situation in which an event is given differing or contradictory interpretations by different observers.\n I was inspired by the film when writing Rashomon, a library for Clojure which rebuilds datastructures from events, with emphasis placed on the flexibility of perspectives, the functions that act for each event. In homage to its eponym it uses testimony to refer to the datastructure being constructed.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  (def bandit-perspectives {:ae.rashomon.event.type/foo , (fn [testimony event] (assoc testimony {:guilt? (not (:qux event))}))}) (def samurai-perspectives {:ae.rashomon.event.type/foo , (fn [testimony event] (assoc testimony {:guilt? (:qux event)}))}) (rashomon/apply-event testimony bandit-perspectives {:ae.rashomon.event/type :ae.rashomon.event.type/foo :qux :guilty}) (rashomon/build samurai-perspectives events)     By changing the set of perspectives we use when applying the event, the testimony we produce can be completely different. This functionality makes it incredibly easy to change our interpretation of events, do A/B testing where different users have different interpretations, read perspectives from configuration.\n I think this is quite novel and I'm excited to see what you can create with it.\n","wordCount":"267","inLanguage":"en","datePublished":"2021-11-19T00:00:00Z","dateModified":"2021-11-19T00:00:00Z","author":{"@type":"Person","name":"AlmostEducated"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.almost.education/posts/rashomon/"},"publisher":{"@type":"Organization","name":"blog.AlmostEducated","logo":{"@type":"ImageObject","url":"http://blog.almost.education/img/ae-logo-trans.png"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=http://blog.almost.education accesskey=h title="blog.AlmostEducated (Alt + H)">
<img src=/img/ae-logo-trans.png alt=logo aria-label=logo height=" 30px">blog.AlmostEducated</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=http://blog.almost.education/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://blog.almost.education/index.xml title=rss>
<span>rss</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
æ/Rashomon
</h1>
<div class=post-meta>2021—11—19 Fri&nbsp;·&nbsp;AlmostEducated
</div>
<ul class=post-tags>
<li><a href=http://blog.almost.education/tags/programming/>programming</a></li>
<li><a href=http://blog.almost.education/tags/clojure/>clojure</a></li>
<li><a href=http://blog.almost.education/tags/event-sourcing/>event sourcing</a></li>
<li><a href=http://blog.almost.education/tags/film/>film</a></li>
</ul>
</header>
<div class=post-content><p>
<em>Clojure functions that build datastructures from events with dynamic perspectives.</em></p>
<p>
<em>Rashomon</em> is a 1950 psychological thriller film directed by Akira Kurosawa. Based on Ryunosuke Akutagawa's <em>In A Grove</em>, it tells the story of a samurai's death from the perspectives of: the bandit who killed him, his wife, the samurai himself, and finally a woodcutter, none of whom can agree at the subsequent trial.</p>
<p>
It was the first Japanese film to receive international acclaim, doing so after being panned by Japanese critics. From the film came the term <em>Rashomon effect</em>, used to describe the situation in which an event is given differing or contradictory interpretations by different observers.</p>
<p>
I was inspired by the film when writing <a href=https://github.com/EducatedAlmost/rashomon>Rashomon</a>, a library for Clojure which rebuilds datastructures from events, with emphasis placed on the flexibility of <em>perspectives</em>, the functions that act for each event. In homage to its eponym it uses <em>testimony</em> to refer to the datastructure being constructed.</p>
<div class="src src-clojure">
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-clojure data-lang=clojure><span class=p>(</span><span class=k>def </span><span class=nv>bandit-perspectives</span>
  <span class=p>{</span><span class=ss>:ae.rashomon.event.type/foo</span>
   ,   <span class=p>(</span><span class=k>fn </span><span class=p>[</span><span class=nv>testimony</span> <span class=nv>event</span><span class=p>]</span> <span class=p>(</span><span class=nb>assoc </span><span class=nv>testimony</span> <span class=p>{</span><span class=ss>:guilt?</span> <span class=p>(</span><span class=nb>not </span><span class=p>(</span><span class=ss>:qux</span> <span class=nv>event</span><span class=p>))}))})</span>

<span class=p>(</span><span class=k>def </span><span class=nv>samurai-perspectives</span>
  <span class=p>{</span><span class=ss>:ae.rashomon.event.type/foo</span>
   ,   <span class=p>(</span><span class=k>fn </span><span class=p>[</span><span class=nv>testimony</span> <span class=nv>event</span><span class=p>]</span> <span class=p>(</span><span class=nb>assoc </span><span class=nv>testimony</span> <span class=p>{</span><span class=ss>:guilt?</span> <span class=p>(</span><span class=ss>:qux</span> <span class=nv>event</span><span class=p>)}))})</span>

<span class=p>(</span><span class=nf>rashomon/apply-event</span>
 <span class=nv>testimony</span>
 <span class=nv>bandit-perspectives</span>
 <span class=p>{</span><span class=ss>:ae.rashomon.event/type</span> <span class=ss>:ae.rashomon.event.type/foo</span>
  <span class=ss>:qux</span> <span class=ss>:guilty</span><span class=p>})</span>

<span class=p>(</span><span class=nf>rashomon/build</span> <span class=nv>samurai-perspectives</span> <span class=nv>events</span><span class=p>)</span></code></pre></td></tr></table>
</div>
</div>
</div>
<p>
By changing the set of perspectives we use when applying the event, the testimony we produce can be completely different. This functionality makes it incredibly easy to change our interpretation of events, do A/B testing where different users have different interpretations, read perspectives from configuration.</p>
<p>
I think this is quite novel and I'm excited to see what you can create with it.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=http://blog.almost.education/tags/programming/>programming</a></li>
<li><a href=http://blog.almost.education/tags/clojure/>clojure</a></li>
<li><a href=http://blog.almost.education/tags/event-sourcing/>event sourcing</a></li>
<li><a href=http://blog.almost.education/tags/film/>film</a></li>
</ul>
</footer><div id=disqus_thread>
</div>
<script>(function(){var a=document,b=a.createElement('script');b.src='https://blog-almost-education.disqus.com/embed.js',b.setAttribute('data-timestamp',+new Date),(a.head||a.body).appendChild(b)})()</script>
<noscript>
Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a>
</noscript>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=http://blog.almost.education>blog.AlmostEducated</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>